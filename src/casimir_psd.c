/* This is a program for testing purposes. It compares results obtained by PSD
 * (Pade spectrum decomposition) and MSD (Matsubara spectrum decomposition)
 *
 * Ref: Hu, Xu, Yan, Pade spectrum decomposition of Fermi function and Bose
 * function, The Journal of Chemical Physics 133, 101106, 2010
 */
#include <stdio.h>
#include <stdlib.h>

#include "libcasimir.h"
#include "sfunc.h"
#include "utils.h"


#define LBYR    0.6
#define T_START 0.9
#define T_STOP  5
#define T_N     100

double psd4[][2] = {
    { 1.0000000230958512315, 1.0000004137549940442 },
    { 1.0010806437583283923, 1.0153135880780634892 },
    { 1.0908796818939034967, 1.9056052237632918889 },
    { 2.2993090757765122234, 18.079080774403625043 },
    { 0, 0 }
};

double psd13[][2] = {
    { 1.000000000000000,   1.000000000000001 },
    { 1.000000000000001,   0.999999999999991 },
    { 0.999999999999999,   1.000000000000064 },
    { 1.000000000000011,   1.000000000000158 },
    { 1.000000000257354,   1.000000011608591 },
    { 1.000000519582035,   1.000020756424606 },
    { 1.000126363809900,   1.004133827101792 },
    { 1.004770480731387,   1.111330652987736 },
    { 1.041277034606124,   1.651789018291181 },
    { 1.157428232669501,   2.912445157884004 },
    { 1.431933120046814,   5.939828836168054 },
    { 2.148725824587908,  16.848984730013321 },
    { 5.898586385593695, 153.031467009523141 },
    { 0                ,   0                 }
};

double psd31[][2] = {
    { 1.0000000000000119904, 1.0000000000000053291 },
    { 1.0000000000000839329, 0.99999999999995914379 },
    { 0.99999999999743227619, 1.0000000000019968471 },
    { 1.0000000000231148434, 0.99999999997020072584 },
    { 0.9999999998811212043, 1.0000000002352127382 },
    { 1.0000000003473772381, 0.99999999913334236545 },
    { 0.99999999964559516119, 1.0000000014168395346 },
    { 1.0000000003263962434, 0.99999998970339842863 },
    { 0.99999997858273237394, 1.0000002427651251136 },
    { 1.0000002086862695982, 0.99999756117531257704 },
    { 0.99999890725174245265, 1.0000138957221318403 },
    { 1.0000038416351217929, 0.99994193676835596563 },
    { 0.99999037434848192518, 1.0001663295958260758 },
    { 1.0000164922224239472, 0.9996459112750927245 },
    { 0.99998681564505731423, 1.000329343269580562 },
    { 0.99997629343592464579, 1.0005559357918296648 },
    { 1.0001146485625367344, 0.99677286277191734509 },
    { 0.99986867210365171221, 1.0129872415166780719 },
    { 1.0014956200634075323, 1.0423217042844896696 },
    { 1.0075958096508732531, 1.2482518145931480458 },
    { 1.0260675390534674811, 1.5570242725182645849 },
    { 1.0600069062225565553, 2.008773945078599521 },
    { 1.1133224968021908641, 2.5944747937563206186 },
    { 1.1911804129828635901, 3.4183682252866631757 },
    { 1.3029032508940687762, 4.6354986902484860423 },
    { 1.4651021510734629771, 6.5639641470547847035 },
    { 1.7096794242217525639, 9.9064892263607724487 },
    { 2.1054627203756584031, 16.499858515437527018 },
    { 2.8318916503310567201, 32.511611495901448166 },
    { 4.5475342731750050262, 90.615897987211610598 },
    { 13.180975763263740319, 816.88744483963432685 },
    { 0, 0 }
};

int main(int argc, char *argv[])
{
    int i;
    casimir_t casimir;
    const double LbyR = LBYR;
    const double Q = 1/(1+LbyR);

    printf("# LbyR, T, F, F_psd, F_psd/F, t_psd/t, lmax\n");
    for(i = 0; i < T_N; i++)
    {
        double t_F, t_F_psd;
        double F = 0, F_psd = 0;
        double T = linspace(T_START, T_STOP, T_N, i);

        casimir_init(&casimir, Q, T);
        casimir_set_lmax(&casimir, MAX(20,6./LbyR));

        t_F = -now();
        F    = casimir_F(&casimir, NULL);
        t_F += now();

        t_F_psd = -now();
        F_psd = casimir_F_psd(&casimir, psd4, NULL);
        t_F_psd += now();

        printf("%.15g, %.15g, %.15g, %.15g, %g, %g, %d\n", LbyR, T, F, F_psd, F_psd/F, t_F_psd/t_F, casimir.lmax);

        casimir_free(&casimir);
    }

    return 0;
}
