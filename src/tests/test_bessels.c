#include "sfunc.h"
#include "unittest.h"

#include "test_bessels.h"

int test_besselI()
{
    unittest_t test;
    unittest_init(&test, "Bessel function I_nu", "Test modified Bessel function I_nu");

    AssertAlmostEqual(&test, bessel_lnInu(0,1e-6), -7.133546631626697);
    AssertAlmostEqual(&test, bessel_lnInu(0,1e-5), -5.982254085113174);
    AssertAlmostEqual(&test, bessel_lnInu(0,1e-4), -4.830961536966152);
    AssertAlmostEqual(&test, bessel_lnInu(0,1e-3), -3.679668825469134);
    AssertAlmostEqual(&test, bessel_lnInu(0,1e-2), -2.528359779027661);
    AssertAlmostEqual(&test, bessel_lnInu(0,1e-1), -1.375417787678169);
    AssertAlmostEqual(&test, bessel_lnInu(0,1e0),  -0.064351991073531);
    AssertAlmostEqual(&test, bessel_lnInu(0,5e0),   3.276297109617906);
    AssertAlmostEqual(&test, bessel_lnInu(0,1e1),   7.929768918237150);
    AssertAlmostEqual(&test, bessel_lnInu(0,1e2),   96.77847637380128);
    AssertAlmostEqual(&test, bessel_lnInu(0,1e3),   995.6271838273042);
    AssertAlmostEqual(&test, bessel_lnInu(0,1e4),   9994.475891280807);
    AssertAlmostEqual(&test, bessel_lnInu(0,1e5),   99993.32459873431);
    AssertAlmostEqual(&test, bessel_lnInu(0,1e6),   999992.1733061878);

    AssertAlmostEqual(&test, bessel_lnInu(1,1e-6), -22.04766947825915);
    AssertAlmostEqual(&test, bessel_lnInu(1,1),    -1.225791352644727);
    AssertAlmostEqual(&test, bessel_lnInu(1,3),     1.131235470744604);
    AssertAlmostEqual(&test, bessel_lnInu(1,1e6),   999992.1733051878);

    AssertAlmostEqual(&test, bessel_lnInu(2,1e-6), -37.47261794865755);
    AssertAlmostEqual(&test, bessel_lnInu(2,1),    -2.862970265776753);
    AssertAlmostEqual(&test, bessel_lnInu(2,5),     2.622265862896675);
    AssertAlmostEqual(&test, bessel_lnInu(2,1e6),   999992.1733031878);

    AssertAlmostEqual(&test, bessel_lnInu(3,1), -4.824473578629219);

    AssertAlmostEqual(&test, bessel_lnInu(23,1e-6), -394.1439513814884);
    AssertAlmostEqual(&test, bessel_lnInu(23,5),    -31.40382021014728);
    AssertAlmostEqual(&test, bessel_lnInu(23,1e6),   999992.1730301876);

    AssertAlmostEqual(&test, bessel_lnInu(119,1e-6), -2189.202200199878);
    AssertAlmostEqual(&test, bessel_lnInu(119,0.5),  -621.0792579289692);
    AssertAlmostEqual(&test, bessel_lnInu(119,3),    -406.9458492626251);
    AssertAlmostEqual(&test, bessel_lnInu(119,30),   -129.9524456900199);
    AssertAlmostEqual(&test, bessel_lnInu(119,300),   272.6929318295042);
    AssertAlmostEqual(&test, bessel_lnInu(119,1e6),   999992.1661661842);

    AssertAlmostEqual(&test, bessel_lnInu(702,1e-6),  -14098.666835519577122094);
    AssertAlmostEqual(&test, bessel_lnInu(702,1e-4),  -10863.534779862939382744);
    AssertAlmostEqual(&test, bessel_lnInu(702,3),     -3621.4923374733442116413);
    AssertAlmostEqual(&test, bessel_lnInu(702,1234),   1034.4300403851143436433);
    AssertAlmostEqual(&test, bessel_lnInu(702,12345),  12319.387046237228462572);

    AssertAlmostEqual(&test, bessel_lnInu(1000,1e-6), -20431.49449839618284504067476857469083458559739000691329331491527130271494692415150511174530433321433136);
    AssertAlmostEqual(&test, bessel_lnInu(1000,1e-3), -13520.28534177430503304703732555770536859193039475630981574458111516287899241469397029910642664433847926);
    AssertAlmostEqual(&test, bessel_lnInu(1000,1e-2), -11216.54895620904939558325377146323337831273555478835379834250875028435403387276682194621363431826046185);
    AssertAlmostEqual(&test, bessel_lnInu(1000,1e-1), -8912.812568197213596709615932332078627838011807630225365847030793958432903503595693734800910969123108949);
    AssertAlmostEqual(&test, bessel_lnInu(1000,0.5),  -7302.56987689676336897185629547968563842185599348104851731012744552380579915803449762971542175940010311);
    AssertAlmostEqual(&test, bessel_lnInu(1000,1),    -6609.075935527395980095353510794756629634116133600495644576672711499531490620620205721104566777718151736);
    AssertAlmostEqual(&test, bessel_lnInu(1000,2),    -5915.581432500951906286933113830174475212197542812903278574505170233704618286689873199126576488624484759);
    AssertAlmostEqual(&test, bessel_lnInu(1000,3),    -5509.912343712945267328979132190846725827912585175241766323863645387105816317555160947497391435769937895);
    AssertAlmostEqual(&test, bessel_lnInu(1000,1e3),  527.8529868786811522194044160531605993285935794084123362983354851474456335452024616554183049996262857132);
    AssertAlmostEqual(&test, bessel_lnInu(1000,1e6),  999991.6728059793130943353171944930595770676683137376427031951094117728445914870010390100004204380158778);
    AssertAlmostEqual(&test, bessel_lnInu(1000,1e10), 9999999987.568085951825096335671462781601752838390393537295559809872338563507206847874714997664267726706);
    AssertAlmostEqual(&test, bessel_lnInu(1000,1e15), 999999999999981.8116732688394846280847341032116508448801327783132111833491683317402934973256801484150616);

    AssertAlmostEqual(&test, bessel_lnInu(2000,1e-6), -42234.8947951300346830473379585826707214203079538014332120868066694902880518301183751383921520494969425);
    AssertAlmostEqual(&test, bessel_lnInu(2000,1e-3), -28415.93035952614447204783470568467897718070211006085666602823655701071729855636012138513811122976041258);
    AssertAlmostEqual(&test, bessel_lnInu(2000,1e-2), -23809.60888097919035546416104198835903437144416816511488244379844717366750919453532138465305412233327301);
    AssertAlmostEqual(&test, bessel_lnInu(2000,1e-1), -19203.28740120802932499732560256073212681904982339600229932769758180770283967628575962492378758150242858);
    AssertAlmostEqual(&test, bessel_lnInu(2000,0.5),  -15983.60682740609501738625934897628044319462397614645244426055481565428756661146279952563523515648114739);
    AssertAlmostEqual(&test, bessel_lnInu(2000,1),    -14596.96579901618788310022105892285226886336166936975392300752135695990335334932173801717581886652626646);
    AssertAlmostEqual(&test, bessel_lnInu(2000,2),    -13210.32448958711494509221620561379881786561635437662305625305769826121572416989512540545545030631885204);
    AssertAlmostEqual(&test, bessel_lnInu(2000,3),    -12399.19091628538400901116191205848297725854953927680784783263266711406481235666137863730296632293393371);
    AssertAlmostEqual(&test, bessel_lnInu(2000,1e3),  -656.7001407818153200995508884583794575393090890821986970759474019249446506053374294457329908466942456937);
    AssertAlmostEqual(&test, bessel_lnInu(2000,1e6),  999990.172305854646890506260540425580200718048383320566781239054287920583607231409451044892287670695543);
    AssertAlmostEqual(&test, bessel_lnInu(2000,1e10), 9999999987.567935901825088833797045489872753210108144726026175057069374821055689737724179572865461042364);
    AssertAlmostEqual(&test, bessel_lnInu(2000,1e15), 999999999999981.8116732673389846280847333529616514704628408616484212659313380072659381246512756849634249);

    AssertAlmostEqual(&test, bessel_lnInu(4000,1e-6), -87227.29694612307885103301200551584468893934317628631616701747428388257490491449595921078459951045462046);
    AssertAlmostEqual(&test, bessel_lnInu(4000,1e-3), -59592.82195255497683347496453777053702759223268379543711139413946158440566685472228673875391501650185858);
    AssertAlmostEqual(&test, bessel_lnInu(4000,1e-2), -50381.33028802611189400370358279645251952481474451288153310550083995161186129622431726580502281311627836);
    AssertAlmostEqual(&test, bessel_lnInu(4000,1e-1), -41169.83862288491394061415797214436124088635805386956508730435453197837201049901216731057019405676491579);
    AssertAlmostEqual(&test, bessel_lnInu(4000,0.5),  -34731.28223919791853593879425243173885979523852046869074163627971168402791815833718992748015213199550572);
    AssertAlmostEqual(&test, bessel_lnInu(4000,1),    -31958.34689651042931842410224045787624374748741273235419697098756105720591195121902889653317233701499943);
    AssertAlmostEqual(&test, bessel_lnInu(4000,2),    -29185.41141325066156495364073509034685044122651157141462840755182641012577013950373091666329274306323488);
    AssertAlmostEqual(&test, bessel_lnInu(4000,3),    -27563.34793588112522068641282910511475846540893261739747848932567748112963109709308894339741344193929689);
    AssertAlmostEqual(&test, bessel_lnInu(4000,1e3),  -4261.873145583658879013976460014704914159555190427781910931416108904940457318241683218735424515843188567);
    AssertAlmostEqual(&test, bessel_lnInu(4000,1e6),  999984.1713128587906335733650400189377789293783936556646686945153563664945363213862064612230031498868859);
    AssertAlmostEqual(&test, bessel_lnInu(4000,1e10), 9999999987.567335801825058838801709659040315205449860133337655607066253440553530455695896644350679577485);
    AssertAlmostEqual(&test, bessel_lnInu(4000,1e15), 999999999999981.8116732613379846280847303524616614751270070283451019295468175489710996535701378306006694);

    AssertAlmostEqual(&test, bessel_lnInu(8000,1e-6), -179983.9969950023818958723876995393909800188974763017267333454621001794193226738815355748703485777624212);
    AssertAlmostEqual(&test, bessel_lnInu(8000,1e-3), -124718.5008855057626382224931432319427460181572261050557869279392886859086270976588649925511516318932633);
    AssertAlmostEqual(&test, bessel_lnInu(8000,1e-2), -106296.6688490038069732059338608830975231912015585440088995771196622498066934297799163208258626503445598);
    AssertAlmostEqual(&test, bessel_lnInu(8000,1e-1), -87874.83681219562719759106262465804127002333030619443972456005074878148865262442015720990821889452308737);
    AssertAlmostEqual(&test, bessel_lnInu(8000,0.5),  -74998.5287862680135848981838044293745688477959626839724242180574439921344595337201466502864576912180495);
    AssertAlmostEqual(&test, bessel_lnInu(8000,1),    -69453.00474476506490151661304603788739112594518375770092839498060548029728159103977633136100975065922163);
    AssertAlmostEqual(&test, bessel_lnInu(8000,2),    -63907.48063296279819814166690502375466408213671760114476051934617734345137408812283483550973103169599278);
    AssertAlmostEqual(&test, bessel_lnInu(8000,3),    -60663.55687932272440755099250763165026480676393420076606234610233332977802891163333224305877662188500793);
    AssertAlmostEqual(&test, bessel_lnInu(8000,1e3),  -14156.32520283222190551846888640361239215109727877354379034198089153864533944898199947572101092991424095);
    AssertAlmostEqual(&test, bessel_lnInu(8000,1e6),  999960.1694608923673604843437031259973842720683280097870091709376176994502755612897910099990837427191856);
    AssertAlmostEqual(&test, bessel_lnInu(8000,1e10), 9999999987.564935601824938988839033039352579446614770672110687190549685675870570807497174476942723721488);
    AssertAlmostEqual(&test, bessel_lnInu(8000,1e15), 999999999999981.8116732373359846280847183514618215124503393621585472476518616826123922719706853820493953);

    return test_results(&test, stderr);
}

int test_besselK()
{
    unittest_t test;
    unittest_init(&test, "Bessel function K_nu", "Test modified Bessel function K_nu");

    AssertAlmostEqual(&test, bessel_lnKnu(0,1e-6), 7.133545631626864);
    AssertAlmostEqual(&test, bessel_lnKnu(0,1e-5), 5.9822440851298415);
    AssertAlmostEqual(&test, bessel_lnKnu(0,1e-4), 4.830861538632819);
    AssertAlmostEqual(&test, bessel_lnKnu(0,1e-3), 3.6786689921357962);
    AssertAlmostEqual(&test, bessel_lnKnu(0,1e-2), 2.5183764456387734);
    AssertAlmostEqual(&test, bessel_lnKnu(0,1e-1), 1.2770838991417504);
    AssertAlmostEqual(&test, bessel_lnKnu(0,1e0), -0.7742086473552725);
    AssertAlmostEqual(&test, bessel_lnKnu(0,5e0), -5.5789276035723227);
    AssertAlmostEqual(&test, bessel_lnKnu(0,1e1), -10.925501193852295);
    AssertAlmostEqual(&test, bessel_lnKnu(0,1e2), -102.07679374034932);
    AssertAlmostEqual(&test, bessel_lnKnu(0,1e3), -1003.2280862868463);
    AssertAlmostEqual(&test, bessel_lnKnu(0,1e4), -10004.379378833343);
    AssertAlmostEqual(&test, bessel_lnKnu(0,1e5), -100005.53067137984);
    AssertAlmostEqual(&test, bessel_lnKnu(0,1e6), -1.0000066819639263e6);

    AssertAlmostEqual(&test, bessel_lnKnu(1,1e-6), 20.949057189590638);
    AssertAlmostEqual(&test, bessel_lnKnu(1,1), -0.08106146679532716);
    AssertAlmostEqual(&test, bessel_lnKnu(1,3),   -3.0358327192375464858953059975);
    AssertAlmostEqual(&test, bessel_lnKnu(1,1e6), -1.00000668196292633e6);

    AssertAlmostEqual(&test, bessel_lnKnu(2,1e-6), 35.863180036223355);
    AssertAlmostEqual(&test, bessel_lnKnu(2,1), 1.17170150170004);
    AssertAlmostEqual(&test, bessel_lnKnu(2,5), -5.036603312746961080665958204772);
    AssertAlmostEqual(&test, bessel_lnKnu(2,1e6), -1.0000066819609263389096196908e6);

    AssertAlmostEqual(&test, bessel_lnKnu(3,1), 2.8367092652889516);

    AssertAlmostEqual(&test, bessel_lnKnu(4,1e15), -1.00000000000001704359684e15);

    AssertAlmostEqual(&test, bessel_lnKnu(23,1e-6), 390.29380377977833);
    AssertAlmostEqual(&test, bessel_lnKnu(23,5), 27.5314997887589672718741222750056);
    AssertAlmostEqual(&test, bessel_lnKnu(23,1e6), -1.00000668168792647542217765299e6);

    AssertAlmostEqual(&test, bessel_lnKnu(119,1e-6), 2183.7257366479472175742539693253862993069);
    AssertAlmostEqual(&test, bessel_lnKnu(119,0.5), 615.6027856231534);
    AssertAlmostEqual(&test, bessel_lnKnu(119,3), 401.4690706673959);
    AssertAlmostEqual(&test, bessel_lnKnu(119,30), 124.44542144141829);
    AssertAlmostEqual(&test, bessel_lnKnu(119,300), -279.16349731660983);

    AssertAlmostEqual(&test, bessel_lnKnu(702,1e-4), 10856.28698728117152647293);
    AssertAlmostEqual(&test, bessel_lnKnu(702,3), 3614.24453577321548255948381274);
    AssertAlmostEqual(&test, bessel_lnKnu(702,1234), -1042.3815655681729711090061175312483747);
    AssertAlmostEqual(&test, bessel_lnKnu(702,12345), -12329.50281632819683895772331427);

    AssertAlmostEqual(&test, bessel_lnKnu(1000,1e-6),  20423.89309606159906635627);
    AssertAlmostEqual(&test, bessel_lnKnu(1000,1e-3),  13512.68393943972082096386);
    AssertAlmostEqual(&test, bessel_lnKnu(1000,1e-2),  11208.94755387441573291358);
    AssertAlmostEqual(&test, bessel_lnKnu(1000,1e-1),  8905.211165857634910126568);
    AssertAlmostEqual(&test, bessel_lnKnu(1000,0.5),   7294.968474437304432718383);
    AssertAlmostEqual(&test, bessel_lnKnu(1000,1),     6601.474532693311622436143);
    AssertAlmostEqual(&test, bessel_lnKnu(1000,2),     5907.980028168368669895212);
    AssertAlmostEqual(&test, bessel_lnKnu(1000,3),     5502.310936882873879713131);
    AssertAlmostEqual(&test, bessel_lnKnu(1000,1e3),  -535.8007129753599475405978);
    AssertAlmostEqual(&test, bessel_lnKnu(1000,1e6),  -1.0000061814642183370632e6);
    AssertAlmostEqual(&test, bessel_lnKnu(1000,1e10), -1.000000001128708406232e10);
    AssertAlmostEqual(&test, bessel_lnKnu(1000,1e15), -1.000000000000017043596e15);

    AssertAlmostEqual(&test, bessel_lnKnu(2000,1e-6), 42226.600495521177448019358477);
    AssertAlmostEqual(&test, bessel_lnKnu(2000,1e-3), 28407.63605991728711208242551347410421605322776491231395994766125798524892054103998951208870236101566941);
    AssertAlmostEqual(&test, bessel_lnKnu(2000,1e-2), 23801.31458137032062668084180759672838125845304252994590033488275479619557180398648170447583186524115216);
    AssertAlmostEqual(&test, bessel_lnKnu(2000,1e-1), 19194.99310159792271442454732704228054213374690854862801051458867730979534557270899831231795565971211545);
    AssertAlmostEqual(&test, bessel_lnKnu(2000,0.5),  15975.31252776600339467187608093312535707914077314634565366819007935807950002404905589483263480947744491);
    AssertAlmostEqual(&test, bessel_lnKnu(2000,1),    14588.67149928239310903330676527722691987526678617877217204826692058691507675101390153701642247065026715);
    AssertAlmostEqual(&test, bessel_lnKnu(2000,2),    13202.03018947850774122088800596258951347650541202564571649218071992060909237818511456811473669964448446);
    AssertAlmostEqual(&test, bessel_lnKnu(2000,3),    12390.89661555209004650742558398621593005116780950542623991805073527084526073691001806428493739840729096);
    AssertAlmostEqual(&test, bessel_lnKnu(2000,1e3),  648.294319366065518802034415498008594181123452365297432127603561720663061711156467581586370132262221493);
    AssertAlmostEqual(&test, bessel_lnKnu(2000,1e6),  -1000004.680965594167105932469829845470103971654739671969866440575207748582971755542128727774922908502889);
    AssertAlmostEqual(&test, bessel_lnKnu(2000,1e10), -10000000011.28693401232551099339419215777417205434467042931479407771019600402239567240065422784110458705);
    AssertAlmostEqual(&test, bessel_lnKnu(2000,1e15), -1000000000000017.043596842809615197771839295685291152554863325436267162553436531272920902463898238115756);

    AssertAlmostEqual(&test, bessel_lnKnu(4000,1e-6), 87218.30962431022872707203747929992341689627115078757177848541018420181526590496669853000535707948105043);
    AssertAlmostEqual(&test, bessel_lnKnu(4000,1e-3), 59583.8346307421266782718303369979951835458053356439749608476403586468383025034290516617373116784943535);
    AssertAlmostEqual(&test, bessel_lnKnu(4000,1e-2), 50372.34296621325864582366863368085614522477703460092789190542474635635856082101806963411345413657562882);
    AssertAlmostEqual(&test, bessel_lnKnu(4000,1e-1), 41160.851301071751394744144810440457725959519868572163158466152688846943729807546819827611861320271251);
    AssertAlmostEqual(&test, bessel_lnKnu(4000,0.5),  34722.29491737725786430966851273097193075748833612255469932574523800736790922639597009183131315162867547);
    AssertAlmostEqual(&test, bessel_lnKnu(4000,1),    31949.35957466633700452248517140962507277118897675355142871180110375542887073319568004144104772358582534);
    AssertAlmostEqual(&test, bessel_lnKnu(4000,2),    29176.42409131284269294289708416534127905998550700586323050651604552252792224738948137099308240196255211);
    AssertAlmostEqual(&test, bessel_lnKnu(4000,3),    27554.36061378709545753675948156390940588399662776337484951699558318700165334748983116456619175217645893);
    AssertAlmostEqual(&test, bessel_lnKnu(4000,1e3),  4252.855518809915147217968820348395014997068929496977491144980088072087695250392941164195951464505546452);
    AssertAlmostEqual(&test, bessel_lnKnu(4000,1e6),  -999998.6799785992508216780632712006845397733590304818079222678338780362049522111419122668802123719085807);
    AssertAlmostEqual(&test, bessel_lnKnu(4000,1e10), -10000000011.28633391232554100839885632093893464983705833223604589886676415462772993916825265553538117486);
    AssertAlmostEqual(&test, bessel_lnKnu(4000,1e15), -1000000000000017.043596836808615197771842296185301157219029492072919832170416072978083103878370155105839);

    AssertAlmostEqual(&test, bessel_lnKnu(8000,1e-6), 179974.3165885031130212062631583732160569413320828456966863695240312238087281376618442420202065316473419);
    AssertAlmostEqual(&test, bessel_lnKnu(8000,1e-3), 124708.8204790064937557448527625045724297784342835417777254980193095072600742586453677603236466532522766);
    AssertAlmostEqual(&test, bessel_lnKnu(8000,1e-2), 106286.9884425045373173874520233600229479668482575041222026565055968236455924213699671918283223289027354);
    AssertAlmostEqual(&test, bessel_lnKnu(8000,1e-1), 87865.15640569628020768844114792572085475116556184305992040044475806470731324385473084800764666375979752);
    AssertAlmostEqual(&test, bessel_lnKnu(8000,0.5),  74988.84837976679182932310959211131822487184722522655096322567026560336265464051048339731537286759014985);
    AssertAlmostEqual(&test, bessel_lnKnu(8000,1),    69443.32433825798450326043131462844891767605154028295587019878032232025736935303482421552396506963482505);
    AssertAlmostEqual(&test, bessel_lnKnu(8000,2),    63897.80022643228322984752900267750820056457238921724818190852011630584705061241136669332821657017258996);
    AssertAlmostEqual(&test, bessel_lnKnu(8000,3),    60653.876472753151824967723539474451331101578374917535227209444149304196586903600665785492173132844005);
    AssertAlmostEqual(&test, bessel_lnKnu(8000,1e3),  14146.63704520101825834842301132270867090113363513077426025787947954438895896688390230097798560738496729);
    AssertAlmostEqual(&test, bessel_lnKnu(8000,1e6),  -999974.678150633867367634820800296254980383456585285837577189092897557328137152920908914483608081513447);
    AssertAlmostEqual(&test, bessel_lnKnu(8000,1e10), -10000000011.28393371232566117843617960522880129134499273676722732703673595636403080796780635596923603828);
    AssertAlmostEqual(&test, bessel_lnKnu(8000,1e15), -1000000000000017.043596812806615197771854297185461194542361824926141174278460206619418746144675877299245);

    return test_results(&test, stderr);
}
