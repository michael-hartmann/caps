#include "sfunc.h"
#include "unittest.h"

#include "test_bessels.h"

int test_besselI()
{
    unittest_t test;
    unittest_init(&test, "Bessel function I_nu", "Test modified Bessel function I_nu");

    AssertAlmostEqual(&test, bessel_lnInu(0,1e-6), -7.133546631626697);
    AssertAlmostEqual(&test, bessel_lnInu(0,1e-5), -5.982254085113174);
    AssertAlmostEqual(&test, bessel_lnInu(0,1e-4), -4.830961536966152);
    AssertAlmostEqual(&test, bessel_lnInu(0,1e-3), -3.679668825469134);
    AssertAlmostEqual(&test, bessel_lnInu(0,1e-2), -2.528359779027661);
    AssertAlmostEqual(&test, bessel_lnInu(0,1e-1), -1.375417787678169);
    AssertAlmostEqual(&test, bessel_lnInu(0,1e0),  -0.064351991073531);
    AssertAlmostEqual(&test, bessel_lnInu(0,5e0),   3.276297109617906);
    AssertAlmostEqual(&test, bessel_lnInu(0,1e1),   7.929768918237150);
    AssertAlmostEqual(&test, bessel_lnInu(0,1e2),   96.77847637380128);
    AssertAlmostEqual(&test, bessel_lnInu(0,1e3),   995.6271838273042);
    AssertAlmostEqual(&test, bessel_lnInu(0,1e4),   9994.475891280807);
    AssertAlmostEqual(&test, bessel_lnInu(0,1e5),   99993.32459873431);
    AssertAlmostEqual(&test, bessel_lnInu(0,1e6),   999992.1733061878);

    AssertAlmostEqual(&test, bessel_lnInu(1,1e-6), -22.04766947825915);
    AssertAlmostEqual(&test, bessel_lnInu(1,1),    -1.225791352644727);
    AssertAlmostEqual(&test, bessel_lnInu(1,3),     1.131235470744604);
    AssertAlmostEqual(&test, bessel_lnInu(1,1e6),   999992.1733051878);

    AssertAlmostEqual(&test, bessel_lnInu(2,1e-6), -37.47261794865755);
    AssertAlmostEqual(&test, bessel_lnInu(2,1),    -2.862970265776753);
    AssertAlmostEqual(&test, bessel_lnInu(2,5),     2.622265862896675);
    AssertAlmostEqual(&test, bessel_lnInu(2,1e6),   999992.1733031878);

    AssertAlmostEqual(&test, bessel_lnInu(3,1), -4.824473578629219);

    AssertAlmostEqual(&test, bessel_lnInu(23,1e-6), -394.1439513814884);
    AssertAlmostEqual(&test, bessel_lnInu(23,5),    -31.40382021014728);
    AssertAlmostEqual(&test, bessel_lnInu(23,1e6),   999992.1730301876);

    AssertAlmostEqual(&test, bessel_lnInu(119,1e-6), -2189.202200199878);
    AssertAlmostEqual(&test, bessel_lnInu(119,0.5),  -621.0792579289692);
    AssertAlmostEqual(&test, bessel_lnInu(119,3),    -406.9458492626251);
    AssertAlmostEqual(&test, bessel_lnInu(119,30),   -129.9524456900199);
    AssertAlmostEqual(&test, bessel_lnInu(119,300),   272.6929318295042);
    AssertAlmostEqual(&test, bessel_lnInu(119,1e6),   999992.1661661842);

    AssertAlmostEqual(&test, bessel_lnInu(702,1e-6),  -14098.666835519577122094);
    AssertAlmostEqual(&test, bessel_lnInu(702,1e-4),  -10863.534779862939382744);
    AssertAlmostEqual(&test, bessel_lnInu(702,3),     -3621.4923374733442116413);
    AssertAlmostEqual(&test, bessel_lnInu(702,1234),   1034.4300403851143436433);
    AssertAlmostEqual(&test, bessel_lnInu(702,12345),  12319.387046237228462572);

    AssertAlmostEqual(&test, bessel_lnInu(1000,1e-6), -20431.49449839618284504067476857469083458559739000691329331491527130271494692415150511174530433321433136);
    AssertAlmostEqual(&test, bessel_lnInu(1000,1e-3), -13520.28534177430503304703732555770536859193039475630981574458111516287899241469397029910642664433847926);
    AssertAlmostEqual(&test, bessel_lnInu(1000,1e-2), -11216.54895620904939558325377146323337831273555478835379834250875028435403387276682194621363431826046185);
    AssertAlmostEqual(&test, bessel_lnInu(1000,1e-1), -8912.812568197213596709615932332078627838011807630225365847030793958432903503595693734800910969123108949);
    AssertAlmostEqual(&test, bessel_lnInu(1000,0.5),  -7302.56987689676336897185629547968563842185599348104851731012744552380579915803449762971542175940010311);
    AssertAlmostEqual(&test, bessel_lnInu(1000,1),    -6609.075935527395980095353510794756629634116133600495644576672711499531490620620205721104566777718151736);
    AssertAlmostEqual(&test, bessel_lnInu(1000,2),    -5915.581432500951906286933113830174475212197542812903278574505170233704618286689873199126576488624484759);
    AssertAlmostEqual(&test, bessel_lnInu(1000,3),    -5509.912343712945267328979132190846725827912585175241766323863645387105816317555160947497391435769937895);
    AssertAlmostEqual(&test, bessel_lnInu(1000,1e3),  527.8529868786811522194044160531605993285935794084123362983354851474456335452024616554183049996262857132);
    AssertAlmostEqual(&test, bessel_lnInu(1000,1e6),  999991.6728059793130943353171944930595770676683137376427031951094117728445914870010390100004204380158778);
    AssertAlmostEqual(&test, bessel_lnInu(1000,1e10), 9999999987.568085951825096335671462781601752838390393537295559809872338563507206847874714997664267726706);
    AssertAlmostEqual(&test, bessel_lnInu(1000,1e15), 999999999999981.8116732688394846280847341032116508448801327783132111833491683317402934973256801484150616);

    AssertAlmostEqual(&test, bessel_lnInu(2000,1e-6), -42234.8947951300346830473379585826707214203079538014332120868066694902880518301183751383921520494969425);
    AssertAlmostEqual(&test, bessel_lnInu(2000,1e-3), -28415.93035952614447204783470568467897718070211006085666602823655701071729855636012138513811122976041258);
    AssertAlmostEqual(&test, bessel_lnInu(2000,1e-2), -23809.60888097919035546416104198835903437144416816511488244379844717366750919453532138465305412233327301);
    AssertAlmostEqual(&test, bessel_lnInu(2000,1e-1), -19203.28740120802932499732560256073212681904982339600229932769758180770283967628575962492378758150242858);
    AssertAlmostEqual(&test, bessel_lnInu(2000,0.5),  -15983.60682740609501738625934897628044319462397614645244426055481565428756661146279952563523515648114739);
    AssertAlmostEqual(&test, bessel_lnInu(2000,1),    -14596.96579901618788310022105892285226886336166936975392300752135695990335334932173801717581886652626646);
    AssertAlmostEqual(&test, bessel_lnInu(2000,2),    -13210.32448958711494509221620561379881786561635437662305625305769826121572416989512540545545030631885204);
    AssertAlmostEqual(&test, bessel_lnInu(2000,3),    -12399.19091628538400901116191205848297725854953927680784783263266711406481235666137863730296632293393371);
    AssertAlmostEqual(&test, bessel_lnInu(2000,1e3),  -656.7001407818153200995508884583794575393090890821986970759474019249446506053374294457329908466942456937);
    AssertAlmostEqual(&test, bessel_lnInu(2000,1e6),  999990.172305854646890506260540425580200718048383320566781239054287920583607231409451044892287670695543);
    AssertAlmostEqual(&test, bessel_lnInu(2000,1e10), 9999999987.567935901825088833797045489872753210108144726026175057069374821055689737724179572865461042364);
    AssertAlmostEqual(&test, bessel_lnInu(2000,1e15), 999999999999981.8116732673389846280847333529616514704628408616484212659313380072659381246512756849634249);

    return test_results(&test, stderr);
}

int test_besselK()
{
    unittest_t test;
    unittest_init(&test, "Bessel function K_nu", "Test modified Bessel function K_nu");

    AssertAlmostEqual(&test, bessel_lnKnu(0,1e-6), 7.133545631626864);
    AssertAlmostEqual(&test, bessel_lnKnu(0,1e-5), 5.9822440851298415);
    AssertAlmostEqual(&test, bessel_lnKnu(0,1e-4), 4.830861538632819);
    AssertAlmostEqual(&test, bessel_lnKnu(0,1e-3), 3.6786689921357962);
    AssertAlmostEqual(&test, bessel_lnKnu(0,1e-2), 2.5183764456387734);
    AssertAlmostEqual(&test, bessel_lnKnu(0,1e-1), 1.2770838991417504);
    AssertAlmostEqual(&test, bessel_lnKnu(0,1e0), -0.7742086473552725);
    AssertAlmostEqual(&test, bessel_lnKnu(0,5e0), -5.5789276035723227);
    AssertAlmostEqual(&test, bessel_lnKnu(0,1e1), -10.925501193852295);
    AssertAlmostEqual(&test, bessel_lnKnu(0,1e2), -102.07679374034932);
    AssertAlmostEqual(&test, bessel_lnKnu(0,1e3), -1003.2280862868463);
    AssertAlmostEqual(&test, bessel_lnKnu(0,1e4), -10004.379378833343);
    AssertAlmostEqual(&test, bessel_lnKnu(0,1e5), -100005.53067137984);
    AssertAlmostEqual(&test, bessel_lnKnu(0,1e6), -1.0000066819639263e6);

    AssertAlmostEqual(&test, bessel_lnKnu(1,1e-6), 20.949057189590638);
    AssertAlmostEqual(&test, bessel_lnKnu(1,1), -0.08106146679532716);
    AssertAlmostEqual(&test, bessel_lnKnu(1,3),   -3.0358327192375464858953059975);
    AssertAlmostEqual(&test, bessel_lnKnu(1,1e6), -1.00000668196292633e6);

    AssertAlmostEqual(&test, bessel_lnKnu(2,1e-6), 35.863180036223355);
    AssertAlmostEqual(&test, bessel_lnKnu(2,1), 1.17170150170004);
    AssertAlmostEqual(&test, bessel_lnKnu(2,5), -5.036603312746961080665958204772);
    AssertAlmostEqual(&test, bessel_lnKnu(2,1e6), -1.0000066819609263389096196908e6);

    AssertAlmostEqual(&test, bessel_lnKnu(3,1), 2.8367092652889516);

    AssertAlmostEqual(&test, bessel_lnKnu(4,1e15), -1.00000000000001704359684e15);

    AssertAlmostEqual(&test, bessel_lnKnu(23,1e-6), 390.29380377977833);
    AssertAlmostEqual(&test, bessel_lnKnu(23,5), 27.5314997887589672718741222750056);
    AssertAlmostEqual(&test, bessel_lnKnu(23,1e6), -1.00000668168792647542217765299e6);

    AssertAlmostEqual(&test, bessel_lnKnu(119,1e-6), 2183.7257366479472175742539693253862993069);
    AssertAlmostEqual(&test, bessel_lnKnu(119,0.5), 615.6027856231534);
    AssertAlmostEqual(&test, bessel_lnKnu(119,3), 401.4690706673959);
    AssertAlmostEqual(&test, bessel_lnKnu(119,30), 124.44542144141829);
    AssertAlmostEqual(&test, bessel_lnKnu(119,300), -279.16349731660983);

    AssertAlmostEqual(&test, bessel_lnKnu(702,1e-4), 10856.28698728117152647293);
    AssertAlmostEqual(&test, bessel_lnKnu(702,3), 3614.24453577321548255948381274);
    AssertAlmostEqual(&test, bessel_lnKnu(702,1234), -1042.3815655681729711090061175312483747);
    AssertAlmostEqual(&test, bessel_lnKnu(702,12345), -12329.50281632819683895772331427);

    AssertAlmostEqual(&test, bessel_lnKnu(1000,1e-6),  20423.89309606159906635627);
    AssertAlmostEqual(&test, bessel_lnKnu(1000,1e-3),  13512.68393943972082096386);
    AssertAlmostEqual(&test, bessel_lnKnu(1000,1e-2),  11208.94755387441573291358);
    AssertAlmostEqual(&test, bessel_lnKnu(1000,1e-1),  8905.211165857634910126568);
    AssertAlmostEqual(&test, bessel_lnKnu(1000,0.5),   7294.968474437304432718383);
    AssertAlmostEqual(&test, bessel_lnKnu(1000,1),     6601.474532693311622436143);
    AssertAlmostEqual(&test, bessel_lnKnu(1000,2),     5907.980028168368669895212);
    AssertAlmostEqual(&test, bessel_lnKnu(1000,3),     5502.310936882873879713131);
    AssertAlmostEqual(&test, bessel_lnKnu(1000,1e3),  -535.8007129753599475405978);
    AssertAlmostEqual(&test, bessel_lnKnu(1000,1e6),  -1.0000061814642183370632e6);
    AssertAlmostEqual(&test, bessel_lnKnu(1000,1e10), -1.000000001128708406232e10);
    AssertAlmostEqual(&test, bessel_lnKnu(1000,1e15), -1.000000000000017043596e15);

    AssertAlmostEqual(&test, bessel_lnKnu(2000,1e-6), 42226.600495521177448019358477);
    AssertAlmostEqual(&test, bessel_lnKnu(2000,1e-3), 28407.63605991728711208242551347410421605322776491231395994766125798524892054103998951208870236101566941);
    AssertAlmostEqual(&test, bessel_lnKnu(2000,1e-2), 23801.31458137032062668084180759672838125845304252994590033488275479619557180398648170447583186524115216);
    AssertAlmostEqual(&test, bessel_lnKnu(2000,1e-1), 19194.99310159792271442454732704228054213374690854862801051458867730979534557270899831231795565971211545);
    AssertAlmostEqual(&test, bessel_lnKnu(2000,0.5),  15975.31252776600339467187608093312535707914077314634565366819007935807950002404905589483263480947744491);
    AssertAlmostEqual(&test, bessel_lnKnu(2000,1),    14588.67149928239310903330676527722691987526678617877217204826692058691507675101390153701642247065026715);
    AssertAlmostEqual(&test, bessel_lnKnu(2000,2),    13202.03018947850774122088800596258951347650541202564571649218071992060909237818511456811473669964448446);
    AssertAlmostEqual(&test, bessel_lnKnu(2000,3),    12390.89661555209004650742558398621593005116780950542623991805073527084526073691001806428493739840729096);
    AssertAlmostEqual(&test, bessel_lnKnu(2000,1e3),  648.294319366065518802034415498008594181123452365297432127603561720663061711156467581586370132262221493);
    AssertAlmostEqual(&test, bessel_lnKnu(2000,1e6),  -1000004.680965594167105932469829845470103971654739671969866440575207748582971755542128727774922908502889);
    AssertAlmostEqual(&test, bessel_lnKnu(2000,1e10), -10000000011.28693401232551099339419215777417205434467042931479407771019600402239567240065422784110458705);
    AssertAlmostEqual(&test, bessel_lnKnu(2000,1e15), -1000000000000017.043596842809615197771839295685291152554863325436267162553436531272920902463898238115756);


    return test_results(&test, stderr);
}
